<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Course - Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .dashboard-header {
            margin: 2rem 0 2.5rem;
        }
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1rem;
            margin: 2rem auto;
            max-width: 760px;
        }
        .quick-btn {
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 2px solid var(--bg-lighter);
            border-radius: 8px;
            text-align: center;
            text-decoration: none;
            color: var(--text);
            transition: all 0.2s;
            font-family: 'JetBrains Mono', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            cursor: pointer;
        }
        .quick-btn:hover {
            border-color: var(--orange);
            transform: translateY(-2px);
        }
        .quick-btn.primary {
            background: var(--green-bright);
            border-color: var(--green-bright);
            color: var(--bg-dark);
            font-weight: 700;
        }
        .quick-btn.primary:hover {
            background: #fff;
        }
        .session-duration {
            width: 100%;
            padding: 0.65rem 0.9rem;
            border-radius: 8px;
            border: 2px solid var(--bg-lighter);
            background: var(--bg-card);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        @media (max-width: 720px) {
            .quick-actions {
                grid-template-columns: 1fr;
                max-width: 100%;
            }
        }
        .quick-btn .btn-icon {
            font-size: 1.5rem;
            display: block;
        }
        .session-timer {
            margin-bottom: 2rem;
        }
        .focus-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            margin: 0.5rem 0 2rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-dim);
        }
        .focus-link {
            padding: 0.35rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 999px;
            text-decoration: none;
            color: var(--cyan);
            transition: all 0.2s;
        }
        .focus-link:hover {
            border-color: var(--cyan);
            color: var(--text-main);
        }
        .progress-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .stat-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--bg-lighter);
            text-align: center;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--orange);
            font-family: 'JetBrains Mono', monospace;
        }
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
        }
        .module-list {
            margin-top: 2rem;
        }
        .track-section {
            margin: 2rem 0;
        }
        .track-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-dim);
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .module-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-card);
            border: 1px solid var(--bg-lighter);
            border-radius: 6px;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }
        .module-item:hover {
            border-color: var(--orange);
        }
        .module-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--green-bright);
        }
        .module-link {
            flex: 1;
            text-decoration: none;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .module-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--text-dim);
            min-width: 80px;
        }
        .module-name {
            font-weight: 500;
        }
        .module-item.completed {
            opacity: 0.6;
        }
        .module-item.completed .module-name {
            text-decoration: line-through;
        }
        .last-studied {
            font-size: 0.75rem;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
        }
        .clear-progress {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--bg-lighter);
            color: var(--text-dim);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s;
        }
        .clear-progress:hover {
            border-color: var(--orange);
            color: var(--orange);
        }
        .export-notes {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid var(--purple);
            color: var(--purple);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.2s;
        }
        .export-notes:hover {
            background: var(--purple);
            color: var(--bg-dark);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="module-header dashboard-header">
            <div class="module-tag">// DASHBOARD</div>
            <h1>Go Course</h1>
            <p class="module-desc">Track your progress through 17 modules</p>
        </div>

        <div class="quick-actions">
            <div class="quick-btn" style="padding: 1rem;">
                <label for="session-duration" style="font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;">Session length</label>
                <select id="session-duration" class="session-duration" onchange="window.updateSessionDuration && window.updateSessionDuration(this.value)">
                    <option value="25-5-15">Pomodoro 25/5/15</option>
                    <option value="50-10-15">Pomodoro 50/10/15</option>
                    <option value="90-20-30">Pomodoro 90/20/30</option>
                </select>
            </div>
            <button class="quick-btn primary" type="button" onclick="startSession(document.getElementById('session-duration').value)">
                <span class="btn-icon">‚è±Ô∏è</span>
                Start session
            </button>
            <a href="#" onclick="resumeLastModule(event)" class="quick-btn">
                <span class="btn-icon">‚ñ∂Ô∏è</span>
                Resume last module
            </a>
            <a href="module0.html" class="quick-btn">
                <span class="btn-icon">üìö</span>
                Quick reference
            </a>
        </div>

        <div class="session-timer" id="session-timer" hidden>
            <div class="session-timer-header">
                <span class="session-title">Session in progress</span>
                <span class="session-countdown" id="session-countdown">25:00</span>
            </div>
            <div class="session-progress">
                <div class="session-progress-bar" id="session-progress"></div>
            </div>
            <div class="session-meta" id="session-label">Focus block ‚Ä¢ 25 min</div>
            <div class="session-controls">
                <button class="session-control-btn" type="button" data-session-action="toggle" onclick="window.sessionToggle && window.sessionToggle()">Pause</button>
                <button class="session-control-btn" type="button" data-session-action="reset" onclick="window.sessionReset && window.sessionReset()">Reset timer</button>
            </div>
        </div>

        <div id="focus-toggle-slot" class="focus-toggle-slot"></div>

        <div class="focus-links">
            <span>Pomodoro stream:</span>
            <a class="focus-link" href="https://www.youtube.com/watch?v=QOfygTDyITY" target="_blank" rel="noopener">Persona 1</a>
            <a class="focus-link" href="https://www.youtube.com/watch?v=brTT4cmTRTY" target="_blank" rel="noopener">Persona 2</a>
        </div>

        <div class="progress-stats">
            <div class="stat-card">
                <div class="stat-value" id="completed-count">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="remaining-count">17</div>
                <div class="stat-label">Remaining</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="progress-percent">0%</div>
                <div class="stat-label">Progress</div>
            </div>
        </div>

        <div class="module-list">
            <!-- Track 0 -->
            <div class="track-section">
                <div class="track-title">Track 0 ‚Ä¢ Foundation</div>
                <div class="module-item" data-module="0">
                    <input type="checkbox" class="module-checkbox" id="m0">
                    <a href="module0.html" class="module-link">
                        <span class="module-num">MODULE 00</span>
                        <span class="module-name">Go Quick Reference</span>
                    </a>
                    <span class="last-studied" id="last-0"></span>
                </div>
            </div>

            <!-- Track 1 -->
            <div class="track-section">
                <div class="track-title">Track 1 ‚Ä¢ Fundamentals</div>
                <div class="module-item" data-module="1">
                    <input type="checkbox" class="module-checkbox" id="m1">
                    <a href="module1.html" class="module-link">
                        <span class="module-num">MODULE 01</span>
                        <span class="module-name">Go Fundamentals</span>
                    </a>
                    <span class="last-studied" id="last-1"></span>
                </div>
                <div class="module-item" data-module="2">
                    <input type="checkbox" class="module-checkbox" id="m2">
                    <a href="module2.html" class="module-link">
                        <span class="module-num">MODULE 02</span>
                        <span class="module-name">Pointers & Memory</span>
                    </a>
                    <span class="last-studied" id="last-2"></span>
                </div>
                <div class="module-item" data-module="3">
                    <input type="checkbox" class="module-checkbox" id="m3">
                    <a href="module3.html" class="module-link">
                        <span class="module-num">MODULE 03</span>
                        <span class="module-name">Structs Deep Dive</span>
                    </a>
                    <span class="last-studied" id="last-3"></span>
                </div>
                <div class="module-item" data-module="4">
                    <input type="checkbox" class="module-checkbox" id="m4">
                    <a href="module4.html" class="module-link">
                        <span class="module-num">MODULE 04</span>
                        <span class="module-name">Interfaces & Polymorphism</span>
                    </a>
                    <span class="last-studied" id="last-4"></span>
                </div>
                <div class="module-item" data-module="5">
                    <input type="checkbox" class="module-checkbox" id="m5">
                    <a href="module5.html" class="module-link">
                        <span class="module-num">MODULE 05</span>
                        <span class="module-name">Data Structures</span>
                    </a>
                    <span class="last-studied" id="last-5"></span>
                </div>
            </div>

            <!-- Track 2 -->
            <div class="track-section">
                <div class="track-title">Track 2 ‚Ä¢ CLI & Tools</div>
                <div class="module-item" data-module="6">
                    <input type="checkbox" class="module-checkbox" id="m6">
                    <a href="module6.html" class="module-link">
                        <span class="module-num">MODULE 06</span>
                        <span class="module-name">CLI Foundations</span>
                    </a>
                    <span class="last-studied" id="last-6"></span>
                </div>
                <div class="module-item" data-module="7">
                    <input type="checkbox" class="module-checkbox" id="m7">
                    <a href="module7.html" class="module-link">
                        <span class="module-num">MODULE 07</span>
                        <span class="module-name">Files, YAML & Shell</span>
                    </a>
                    <span class="last-studied" id="last-7"></span>
                </div>
                <div class="module-item" data-module="8">
                    <input type="checkbox" class="module-checkbox" id="m8">
                    <a href="module8.html" class="module-link">
                        <span class="module-num">MODULE 08</span>
                        <span class="module-name">Building TUIs</span>
                    </a>
                    <span class="last-studied" id="last-8"></span>
                </div>
            </div>

            <!-- Track 3 -->
            <div class="track-section">
                <div class="track-title">Track 3 ‚Ä¢ Production Code</div>
                <div class="module-item" data-module="9">
                    <input type="checkbox" class="module-checkbox" id="m9">
                    <a href="module9.html" class="module-link">
                        <span class="module-num">MODULE 09</span>
                        <span class="module-name">Error Handling & Testing</span>
                    </a>
                    <span class="last-studied" id="last-9"></span>
                </div>
                <div class="module-item" data-module="10">
                    <input type="checkbox" class="module-checkbox" id="m10">
                    <a href="module10.html" class="module-link">
                        <span class="module-num">MODULE 10</span>
                        <span class="module-name">Design Patterns</span>
                    </a>
                    <span class="last-studied" id="last-10"></span>
                </div>
                <div class="module-item" data-module="11">
                    <input type="checkbox" class="module-checkbox" id="m11">
                    <a href="module11.html" class="module-link">
                        <span class="module-num">MODULE 11</span>
                        <span class="module-name">HTTP & API Design</span>
                    </a>
                    <span class="last-studied" id="last-11"></span>
                </div>
            </div>

            <!-- Track 4 -->
            <div class="track-section">
                <div class="track-title">Track 4 ‚Ä¢ Advanced</div>
                <div class="module-item" data-module="12">
                    <input type="checkbox" class="module-checkbox" id="m12">
                    <a href="module12.html" class="module-link">
                        <span class="module-num">MODULE 12</span>
                        <span class="module-name">Concurrency & Goroutines</span>
                    </a>
                    <span class="last-studied" id="last-12"></span>
                </div>
            </div>

            <!-- Track 5 -->
            <div class="track-section">
                <div class="track-title">Track 5 ‚Ä¢ Real-World</div>
                <div class="module-item" data-module="13">
                    <input type="checkbox" class="module-checkbox" id="m13">
                    <a href="module13.html" class="module-link">
                        <span class="module-num">MODULE 13</span>
                        <span class="module-name">Project Structure</span>
                    </a>
                    <span class="last-studied" id="last-13"></span>
                </div>
                <div class="module-item" data-module="14">
                    <input type="checkbox" class="module-checkbox" id="m14">
                    <a href="module14.html" class="module-link">
                        <span class="module-num">MODULE 14</span>
                        <span class="module-name">System Interaction</span>
                    </a>
                    <span class="last-studied" id="last-14"></span>
                </div>
                <div class="module-item" data-module="15">
                    <input type="checkbox" class="module-checkbox" id="m15">
                    <a href="module15.html" class="module-link">
                        <span class="module-num">MODULE 15</span>
                        <span class="module-name">Sets & Diffing</span>
                    </a>
                    <span class="last-studied" id="last-15"></span>
                </div>
            </div>

            <!-- Track 6 -->
            <div class="track-section">
                <div class="track-title">Track 6 ‚Ä¢ Testing</div>
                <div class="module-item" data-module="16">
                    <input type="checkbox" class="module-checkbox" id="m16">
                    <a href="module16.html" class="module-link">
                        <span class="module-num">MODULE 16</span>
                        <span class="module-name">Unit Testing</span>
                    </a>
                    <span class="last-studied" id="last-16"></span>
                </div>
                <div class="module-item" data-module="17">
                    <input type="checkbox" class="module-checkbox" id="m17">
                    <a href="module17.html" class="module-link">
                        <span class="module-num">MODULE 17</span>
                        <span class="module-name">Integration Testing</span>
                    </a>
                    <span class="last-studied" id="last-17"></span>
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
            <button class="export-notes" onclick="exportNotes()">üì• Export Notes to Markdown</button>
            <button class="clear-progress" onclick="clearProgress()">Clear All Progress</button>
        </div>
    </div>

    <script src="theme.js"></script>
    <script>
        // Progress tracking with localStorage
        const STORAGE_KEY = 'go-course-progress';
        const LAST_MODULE_KEY = 'go-course-last-module';

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            return saved ? JSON.parse(saved) : {};
        }

        function saveProgress(moduleNum, completed) {
            const progress = loadProgress();
            progress[moduleNum] = {
                completed,
                lastStudied: completed ? new Date().toISOString() : (progress[moduleNum]?.lastStudied || null)
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
            updateStats();
        }

        function updateStats() {
            const progress = loadProgress();
            const total = 17;
            const completed = Object.values(progress).filter(p => p.completed).length;
            const remaining = total - completed;
            const percent = Math.round((completed / total) * 100);

            document.getElementById('completed-count').textContent = completed;
            document.getElementById('remaining-count').textContent = remaining;
            document.getElementById('progress-percent').textContent = percent + '%';

            // Update UI
            for (let i = 0; i <= 17; i++) {
                const checkbox = document.getElementById(`m${i}`);
                const item = document.querySelector(`[data-module="${i}"]`);
                const lastStudied = document.getElementById(`last-${i}`);

                if (checkbox && progress[i]) {
                    checkbox.checked = progress[i].completed;
                    if (progress[i].completed && item) {
                        item.classList.add('completed');
                    }
                    if (progress[i].lastStudied && lastStudied) {
                        const date = new Date(progress[i].lastStudied);
                        lastStudied.textContent = date.toLocaleDateString();
                    }
                }
            }
        }

        function recordModuleVisit(moduleNum) {
            localStorage.setItem(LAST_MODULE_KEY, moduleNum);
            const progress = loadProgress();
            if (!progress[moduleNum]) {
                progress[moduleNum] = { completed: false };
            }
            progress[moduleNum].lastStudied = new Date().toISOString();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }

        function resumeLastModule(e) {
            e.preventDefault();
            const lastModule = localStorage.getItem(LAST_MODULE_KEY);
            if (lastModule) {
                window.location.href = `module${lastModule}.html`;
            } else {
                window.location.href = 'module0.html';
            }
        }


        function exportNotes() {
            const notesKey = 'go-course-personal-notes';
            const allNotes = JSON.parse(localStorage.getItem(notesKey) || '{}');

            if (Object.keys(allNotes).length === 0) {
                alert('No notes to export yet!');
                return;
            }

            // Group notes by section
            const grouped = {
                warmups: [],
                challenges: [],
                advanced: []
            };

            Object.entries(allNotes).forEach(([key, note]) => {
                if (note.trim() === '') return; // Skip empty notes

                const [exerciseId, variantId] = key.split('_');
                const section = exerciseId.replace(/[0-9]/g, ''); // warmup, challenge, advanced

                let title = key;
                if (exerciseId.startsWith('warmup')) {
                    title = `Warmup ${exerciseId.replace('warmup', '')} - Variant ${variantId.replace('v', '')}`;
                } else if (exerciseId.startsWith('challenge')) {
                    title = `Challenge ${exerciseId.replace('challenge', '')} - Variant ${variantId.replace('v', '')}`;
                } else if (exerciseId.startsWith('advanced')) {
                    title = `Advanced ${exerciseId.replace('advanced', '')} - Variant ${variantId.replace('v', '')}`;
                }

                const item = { title, note };

                if (section === 'warmup') {
                    grouped.warmups.push(item);
                } else if (section === 'challenge') {
                    grouped.challenges.push(item);
                } else if (section === 'advanced') {
                    grouped.advanced.push(item);
                }
            });

            // Generate Markdown
            let markdown = `# Go Course - Personal Notes\n\n`;
            markdown += `Exported on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}\n\n`;
            markdown += `---\n\n`;

            if (grouped.warmups.length > 0) {
                markdown += `## Warmups\n\n`;
                grouped.warmups.forEach(({ title, note }) => {
                    markdown += `### ${title}\n\n${note}\n\n---\n\n`;
                });
            }

            if (grouped.challenges.length > 0) {
                markdown += `## Challenges\n\n`;
                grouped.challenges.forEach(({ title, note }) => {
                    markdown += `### ${title}\n\n${note}\n\n---\n\n`;
                });
            }

            if (grouped.advanced.length > 0) {
                markdown += `## Advanced\n\n`;
                grouped.advanced.forEach(({ title, note }) => {
                    markdown += `### ${title}\n\n${note}\n\n---\n\n`;
                });
            }

            // Create and download file
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `go-course-notes-${new Date().toISOString().split('T')[0]}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearProgress() {
            if (confirm('Clear all progress? This cannot be undone.')) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(LAST_MODULE_KEY);
                location.reload();
            }
        }

        // Add event listeners to checkboxes
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            if (window.updateSessionTimer) {
                window.updateSessionTimer();
            }

            document.querySelectorAll('.module-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const moduleNum = e.target.id.replace('m', '');
                    const item = document.querySelector(`[data-module="${moduleNum}"]`);

                    saveProgress(moduleNum, e.target.checked);

                    if (e.target.checked) {
                        item?.classList.add('completed');
                    } else {
                        item?.classList.remove('completed');
                    }
                });
            });

            // Track clicks on module links
            document.querySelectorAll('.module-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    const moduleNum = link.closest('[data-module]').dataset.module;
                    recordModuleVisit(moduleNum);
                });
            });
        });
    </script>
</body>
</html>
